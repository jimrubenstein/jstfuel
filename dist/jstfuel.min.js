jstfuel=function(){function a(){this.queue=[],this.timeout=null,this.timeoutInterval=15e3,this.running=!1}function b(a){return this.compiled_src=a.compiled_src||null,this.getter=a.accessor||a.getter||this.get,this.src_root=a.src_root||null,this.compiler=a.compiler||this.compiler,this._tplCache={},this._tplLoaded=!1,this._watching=!1,this}function c(a){var b=null,c=window;if(a.indexOf(".")>-1){for(var d=a.split("."),e=null,f=0,g=d.length;g>f;f++){if(e=d[f],void 0===c[e])return null;c=c[e]}b=c}else{if(void 0===c[a])return null;b=c[a]}return b}function d(a){return void 0===a?j:(j=a,n)}function e(a){if(void 0===a){for(a in k)e(a);return!0}return void 0!==k[a]?(k[a].watch(!0),m.watch(a),!0):!1}function f(a){if(void 0===a){for(a in k)f(a);return!0}return void 0!==k[a]?(k[a].watch(!1),m.unwatch(a),!0):!1}function g(a){m.watchInterval(a)}function h(){console&&console.log&&console.log.apply(console,arguments)}function i(a){void 0!==a.compiled_src&&(a={tpl:a});for(nspace in a){if(nspace in n)throw"Can not overwrite jstfuel base api methods. ("+nspace+")";k[nspace]=new b({compiled_src:a[nspace].compiled_src,getter:a[nspace].accessor||a[nspace].getter||null,src_root:a[nspace].src_root||null,compiler:a[nspace].compiler||null}),jstfuel[nspace]=function(){return k[nspace].renderer.apply(k[nspace],arguments)}}return n}var j="prod",k={},l={MODE_DEV:"dev",MODE_PROD:"prod"};a.prototype.watchInterval=function(a){return void 0==a?this.timeoutInterval/1e3:(this.timeoutInterval=1e3*a,this.stop(),this.start(),this)},a.prototype.watch=function(a){return-1==this.queue.indexOf(a)&&(this.queue.push(a),this.running||this.start()),this},a.prototype.unwatch=function(a){return this.queue.indexOf(a)>-1&&this.queue.splice(this.queue.indexOf(a),1),0==this.queue.length&&this.stop(),this},a.prototype.start=function(){this.running=!0,this._processQueue()},a.prototype.stop=function(){return this.timeout&&clearTimeout(this.timeout),this.timeout=null,this.running=!1,this},a.prototype._processQueue=function(){var a=0,b=this,c=function(d){if(0==b.queue.length)return d.call(b);if(a==b.queue.length)return d.call(b);if(0==b.running)return d.call(b);var e=b.queue[a];h("Loading templates for "+e),k[e].loadTemplate(null,!0,function(){return h("Templates loaded ("+e+")"),a++,c(d)})};c(this._waitToProcess)},a.prototype._waitToProcess=function(){if(this.running){var a=this;this.timeout=setTimeout(function(){a._processQueue.call(a)},this.timeoutInterval)}return this},b.prototype.watch=function(a){return void 0===a?a:(this._watching=a,this)},b.prototype.renderer=function(a){var b=this;return this.loadTemplate(a,!0),function(c){return b.render(a,c)}},b.prototype.render=function(a,b){return this.getTemplate(a)(b)},b.prototype.getter="JST",b.prototype.get=function(a){if("string"==typeof this.getter){var b=c(this.getter);return void 0!==a?b?b[a]:void 0:b}if("function"==typeof this.getter)return this.getter(a);if("object"==typeof this.getter)return void 0!==a?this.getter[a]:this.getter;throw"jstfuel doesn't know how to process your template getter."},b.prototype.getTemplate=function(a){if(void 0==this._tplCache[a]){if(void 0==this.get(a))return this.loadTemplate(a,!1),this.getTemplate(a);this._tplCache[a]=this.get(a)}return this._tplCache[a]},b.prototype.loadTemplate=function(a,b,c){function e(){if(0==Object.keys(g._tplCache).length)return c.call();if(Object.keys(g._tplCache).length==f)return c.call();var a=Object.keys(g._tplCache)[f];g.loadRawTemplate(a,b,function(){f++,e()})}if(l.MODE_DEV==d()&&this.src_root){var b=void 0===b?!1:b;if(void 0===a||null===a){var f=0,g=this;e()}else this.loadRawTemplate(a,b,c)}else this.loadCompiledTemplates(void 0===b?!0:b,c)},b.prototype.loadCompiledTemplates=function(a,b){var c=this;return $.ajax({url:this.compiled_src,dataType:"script",cache:!1,type:"GET",async:void 0===a?!0:a,success:function(){c.cacheTemplate(c.get()),void 0!==b&&b()}})},b.prototype.loadRawTemplate=function(a,b,c){var d=this;return $.ajax({url:this.src_root+("/"+a).replace(/^\/\//,"/"),dataType:"text",cache:!1,type:"GET",async:void 0===b?!1:b,success:function(b){d.compileTemplate(a,b),void 0!==c&&c()},error:function(a,b,c){throw c}})},b.prototype.cacheTemplate=function(){var a={};2==arguments.length?a[arguments[0]]=arguments[1]:a=arguments[0];for(tpl_name in a){var b=a[tpl_name];this._tplCache[tpl_name]=b}return this},b.prototype.compileTemplate=function(a,b){return this.cacheTemplate(a,this.compiler(b)),this},b.prototype.compiler=function(a){return _.template(a)};var m=new a,n={init:i,mode:d,watch:e,unwatch:f,watchInterval:g};return n}();